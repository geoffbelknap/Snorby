<% # Big long ugly URL to DeepSee Sonar App on Solera DS Appliance  %>
<% # This should probalby go somewhere else. %>
<% event_specific_sonarcall = "https://#{@event.sensor.solera_dsfs_hostname}/deepsee_reports?user=#{current_user.solera_dsfs_user}&password=#{current_user.solera_dsfs_password}#pathString=%2Ftimespan%2F#{@event.timestamp.getutc.strftime('%m.%d.%Y.%I.%M.%S')}.#{@event.timestamp.getutc.strftime('%m.%d.%Y.%I.%M.%S')}%2Fipv4_address%2F#{@event.source_ip}_and_#{@event.destination_ip}%2F;reportIndex=0" %>
<% # Big long ugly URL to Grab PCAP from Solera DS Appliance  %>
<% # This, too, should probalby go somewhere else. %>
<% dspcapcall2 = "https://#{@event.sensor.solera_dsfs_hostname}/ws/pcap?method=deepsee&user=#{current_user.solera_dsfs_user}&password=#{current_user.solera_dsfs_password}&path=%2Ftimespan%2F#{@event.timestamp.getutc.strftime('%m.%d.%Y.%I.%M.%S')}.#{@event.timestamp.getutc.strftime('%m.%d.%Y.%I.%M.%S')}%2Fipv4_address%2F#{@event.source_ip}_and_#{@event.destination_ip}%2Fdata.pcap" %>

<div id="event_show_page">
	<div id="search_options" class='round'>
		<%- if @event.importance.present? -%>
		
		<span id='important_load_<%= @event.sid + @event.cid %>' style='display:none;'><%= image_tag('ajax.gif', :size=>'14x14') %></span>
		<%= link_to_remote image_tag('other/is_important.png', :size => '14x14', :id => "important_#{@event.sid + @event.cid}"), :url => { :controller => 'events', :action => "important", :id => @event }, :loading => "$('#important_#{@event.sid + @event.cid}').hide();$('#important_load_#{@event.sid + @event.cid}').show()", :complete => "$('#important_load_#{@event.sid + @event.cid}').hide()", :html => {:title => 'Change Event Importance.', :class => 'add_tipsy'} %>

		<%- else -%>
		<span id='important_load_<%= @event.sid + @event.cid %>' style='display:none;'><%= image_tag('ajax.gif', :size=>'14x14') %></span>
		<%= link_to_remote image_tag('other/is_not_important.png', :size => '14x14', :id => "important_#{@event.sid + @event.cid}"), :url => { :controller => 'events', :action => "important", :id => @event }, :loading => "$('#important_#{@event.sid + @event.cid}').hide();$('#important_load_#{@event.sid + @event.cid}').show()", :complete => "$('#important_load_#{@event.sid + @event.cid}').hide()", :html => { :title => 'Change Event Importance.', :class => 'add_tipsy' } %>

		<%- end -%>
		<a href='#scroll_to_comment' id='scroll_to_comment'><%= image_tag('other/show_comments.png', :size=>'14x14', :title => 'Scroll To Event Comments.', :class => 'add_tipsy') %></a>
		<% # This should be wrapped in some kind of conditional %>
		<% # Link to Download Event as PCAP from Solera DS Appliance %>
		<%= link_to "#{image_tag('other/solera_logo.gif', :size => '14x14', :title => 'Download Event as PCAP.', :class => 'add_tipsy')}", "#{dspcapcall2}" %>
		<% # This should be wrapped in some kind of conditional %>
		<% # See Data about just Source IP and Dest IP (in the event's timespan) in DeepSee Sonar %>
		<%= link_to "#{image_tag('other/solera_sonar_logo.gif', :size => '14x14', :title => 'See Event in DeepSee Sonar.', :class => 'add_tipsy')}", "#{event_specific_sonarcall}", :target => "_blank" %>
		<%= link_to "#{image_tag('export/pdf.png', :size => '14x14', :title => 'Export To PDF.', :class => 'add_tipsy')}", { :format => 'pdf' } %>
		<%= link_to "#{image_tag('export/xml.png', :size => '14x14', :title => 'Export To XML.', :class => 'add_tipsy')}", { :format => 'xml' } %>
		<%= link_to "#{image_tag('export/email.png', :size => '14x14', :title => 'Email This Event.', :class => 'add_tipsy')}", send_event_path(@event), :rel => 'facebox' %>
		<%- if current_user.admin -%>
		<%= link_to "#{image_tag('other/slash.png', :size => '14x14', :id => "destroy_event_#{@event.sid + @event.cid}", :title => 'Delete This Event.', :class => 'add_tipsy')}", { :action => 'remove_event', :id => @event }, :id => 'remove_fade_in', :title => "Destroy Event: #{@event.sig.sig_name}" %>
		<%- end -%>
	</div>
	<strong class='event_title'><%= @event.sig.sig_name %></strong>

	<div id="event_show_information">

		<br />

		<%= render :partial => 'summary' %>

		<%- unless @event.iphdr.blank? -%>
			<%= render :partial => 'ip_data' %>
		<%- end -%>

		<%- unless @event.tcphdr.blank? -%>
			<%= render :partial => 'tcp_data' %>
		<%- end -%>

		<%- unless @event.udphdr.blank? -%>
			<%= render :partial => 'udp_data' %>
		<%- end -%>

		<%- unless @event.icmphdr.blank? -%>
			<%= render :partial => 'icmp_data' %>
		<%- end -%>

		<%- unless @event.opt.blank? -%>
			<%= render :partial => 'payload_data' %>
		<%- end -%>

		<%- unless @event.data_info.blank? -%>
			<%= render :partial => 'payload_data' %>
		<%- end -%>
		
		<br />
		<%= render :partial => 'comments_for_event' %>
		
	</div>
</div>